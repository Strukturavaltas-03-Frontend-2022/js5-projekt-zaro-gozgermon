<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
</head>
<body>
    <table class="theTable">
        <tr>
            <th>ID</th>
            <th>NAME</th>
            <th>E-MAIL</th>
            <th>ADDRESS</th>
        </tr>
        <tr class="data_row" id="1">
            <td>12</td>
            <td>john doe</td>
            <td>john@doe.com</td>
            <td>112 nowhere str Dunno</td>
            <td><button>Edit</button></td>
            <td><button>Delet</button></td>
        </tr>
        <tr>
            <td><input type="text" value="12"></td>
            <td><input type="text" value="john doe"></td>
            <td><input type="text" value="john@doe.com"></td>
            <td><input type="text" value="112 nowhere str Dunno"></td>
            <td><button>Save</button></td>
            <td><button>Cancel</button></td>
        </tr>

    </table>
<script>
//start server in terminal: json-server --watch ./data/MOCK_DATA.json

let rowDataForCancel=
    {id:0,
    name:"",
    email:"",
    address:""}

function cancelClickHandler(cancelButton)
{
    let tableRow=document.querySelector(`[id='${parseInt(cancelButton.id)}_data_row']`)

    tableRow.innerHTML= `<tr class="data_row" id="${rowDataForCancel.id}_data_row">
                    <td>${rowDataForCancel.id}</td>
                    <td>${rowDataForCancel.name}</td>
                    <td>${rowDataForCancel.email}</td>
                    <td>${rowDataForCancel.address}</td>
                    <td><button class="data_row_button" id="${rowDataForCancel.id}_edit" onclick="editClickHandler(this)">Edit</button></td>
                    <td><button class="data_row_button" id="${rowDataForCancel.id}_delete" onclick="delClickHandler(this)">Delete</button></td>
                    </tr>`
}

function editClickHandler(editButton)
{
    let tableRow=document.querySelector(`[id='${parseInt(editButton.id)}_data_row']`)
    let row_data=document.querySelectorAll(`[id='${parseInt(editButton.id)}_data_row'] td`)

    rowDataForCancel.id=row_data[0].innerHTML
    rowDataForCancel.name=row_data[1].innerHTML
    rowDataForCancel.email=row_data[2].innerHTML
    rowDataForCancel.address=row_data[3].innerHTML


    tableRow.innerHTML= `<td><input type="text" value="${row_data[0].innerHTML}"></td>
                        <td><input type="text" value="${row_data[1].innerHTML}"></td>
                        <td><input type="text" value="${row_data[2].innerHTML}"></td>
                        <td><input type="text" value="${row_data[3].innerHTML}"></td>
                        <td><button class="data_row_button" id="${parseInt(editButton.id)}_save">Save</button></td>
                        <td><button class="data_row_button" id="${parseInt(editButton.id)}_cancel" onclick="cancelClickHandler(this)">Cancel</button></td>`
                    
}
function delClickHandler(delButton)
{

    let tableRow=document.querySelector(`[id='${parseInt(delButton.id)}_data_row']`)
    //let tableRow=document.getElementById(`${parseInt(delButton.id)}_data_row`)

    tableRow.remove();

}
    function updateFullTable(data)
    {
        let theTable=document.querySelector(".theTable")
        let data_rows=data.map(item=>{
            return `<tr class="data_row" id="${item.id}_data_row">
                    <td>${item.id}</td>
                    <td>${item.name}</td>
                    <td>${item.email}</td>
                    <td>${item.address}</td>
                    <td><button class="data_row_button" id="${item.id}_edit" onclick="editClickHandler(this)">Edit</button></td>
                    <td><button class="data_row_button" id="${item.id}_delete" onclick="delClickHandler(this)">Delete</button></td>
                </tr>`
            }).join('');

            theTable.innerHTML=`<tr>
                                    <th>ID</th>
                                    <th>NAME</th>
                                    <th>E-MAIL</th>
                                    <th>ADDRESS</th>
                                </tr>
                                <tr>
                                    <td><input type="text" value="Add"></td>
                                    <td><input type="text" value="new"></td>
                                    <td><input type="text" value="user"></td>
                                    <td><input type="text" value="here."></td>
                                    <td><button>Save</button></td>
                                    <td><button>Cancel</button></td>
                                </tr>
                                ${data_rows}`   



    }
   

    fetch(`http://localhost:3000/users`)
    .then((response)=>response.json())
    .then(data=>{console.log(data)
            updateFullTable(data)})
    

</script>



</body>
</html>